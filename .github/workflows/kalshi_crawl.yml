name: Kalshi Crawl + Fan-out

on:
  workflow_dispatch:
  schedule:
    - cron: "0 15,21,3,9 * * *"

permissions:
  contents: write

jobs:
  crawl:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout orchestrator
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # Push 충돌 방지를 위해 전체 이력 필요
          token: ${{ secrets.GH_PAT }} # 권한이 충분한 PAT 사용 권장

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install dependencies
        run: pip install requests

      - name: Run Crawl & Stats
        env:
          GH_PAT: ${{ secrets.GH_PAT }}
          GITHUB_OWNER: "statground"
        run: python scripts/kalshi_crawl_and_fanout.py